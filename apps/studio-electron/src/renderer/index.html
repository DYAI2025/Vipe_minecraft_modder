<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'; img-src 'self' data:; connect-src 'self' ws://127.0.0.1:* http://127.0.0.1:* http://localhost:* https://api.openai.com https://api.anthropic.com https://api.elevenlabs.io">
  <title>KidModStudio - Baue deinen eigenen Minecraft Mod!</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="header-title">
      <span class="logo">â›ï¸</span>
      <h1>KidModStudio</h1>
    </div>
    <p class="header-subtitle">Baue deinen eigenen Minecraft Mod!</p>
    <button class="mc-button settings-btn" title="Einstellungen">âš™ï¸</button>
  </header>

  <!-- Main Content -->
  <main class="main-container">
    <!-- Left: Inventar -->
    <aside class="inventory-panel">
      <h2>ğŸ“¦ Inventar</h2>
      <div class="inventory-tabs">
        <button class="inv-tab active" data-tab="blocks">ğŸ§± BlÃ¶cke</button>
        <button class="inv-tab" data-tab="items">âš”ï¸ Items</button>
        <button class="inv-tab" data-tab="mobs">ğŸ· Kreaturen</button>
      </div>
      <div class="inventory-grid" id="inventory-grid">
        <!-- Items werden per JS geladen -->
      </div>
    </aside>

    <!-- Center: Werkbank -->
    <section class="workbench">
      <h2>ğŸ”¨ Werkbank</h2>
      <!-- Crafty Feedback -->
      <div class="crafty-feedback" id="crafty">
        <span class="crafty-avatar">ğŸ¤–</span>
        <p class="crafty-message" id="crafty-message">Willkommen! Zieh BlÃ¶cke in die Werkbank!</p>
      </div>
      <div class="crafting-area">
        <div class="crafting-grid">
          <div class="craft-slot" data-slot="0"></div>
          <div class="craft-slot" data-slot="1"></div>
          <div class="craft-slot" data-slot="2"></div>
          <div class="craft-slot" data-slot="3"></div>
          <div class="craft-slot center-slot" data-slot="4">
            <span class="slot-hint">Hauptblock</span>
          </div>
          <div class="craft-slot" data-slot="5"></div>
          <div class="craft-slot" data-slot="6"></div>
          <div class="craft-slot" data-slot="7"></div>
          <div class="craft-slot" data-slot="8"></div>
        </div>
        <div class="crafting-arrow">â¡ï¸</div>
        <div class="crafting-result">
          <div class="result-slot" id="result-slot">
            <span class="slot-hint">Dein Mod</span>
          </div>
        </div>
      </div>
      <div class="action-buttons">
        <button class="mc-button primary" id="btn-create">âš’ï¸ Mod bauen!</button>
        <button class="mc-button" id="btn-clear">ğŸ—‘ï¸ Leeren</button>
      </div>
    </section>

    <!-- Right: Chat Panel -->
    <aside class="helper-panel chat-panel" id="chat-panel">
      <div class="chat-header">
        <h3>ğŸ’¬ Chat mit Crafty</h3>
        <div class="chat-status" id="chat-status" title="Nicht verbunden"></div>
      </div>

      <div class="chat-messages" id="chat-messages">
        <!-- Messages inserted by JS -->
      </div>

      <div class="chat-input-area">
        <input type="text" id="chat-input" placeholder="Nachricht eingeben...">
        <button class="mc-button" id="chat-send" title="Senden">â¤</button>
        <button class="mc-button" id="chat-voice" title="Sprechen">ğŸ¤</button>
      </div>
    </aside>
  </main>

  <!-- Footer: Spracheingabe -->
  <footer class="voice-footer">
    <button class="mc-button gold voice-btn" id="btn-voice">
      <span class="mic-icon">ğŸ¤</span>
      <span class="voice-text">Sprich mit mir!</span>
    </button>
    <div class="voice-feedback" id="voice-feedback">
      <div class="sound-wave"></div>
      <p class="voice-transcript" id="voice-transcript"></p>
    </div>
  </footer>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settings-modal" style="display: none;">
    <div class="modal-content">
      <h2>âš™ï¸ Einstellungen</h2>

      <div class="settings-section">
        <h3>ğŸ—£ï¸ Sprachausgabe (TTS)</h3>
        <label class="settings-row">
          <span>Modus:</span>
          <select id="tts-mode">
            <option value="system">ğŸ’» System (Einfach)</option>
            <option value="hq">ğŸš€ Vipe HQ (Realtime)</option>
          </select>
        </label>

        <!-- System TTS Settings -->
        <div id="tts-system-settings">
          <label class="settings-row">
            <span>Stimme:</span>
            <select id="tts-voice"></select>
          </label>
        </div>

        <!-- HQ Voice Design Settings -->
        <div id="tts-hq-settings" style="display: none;">
          <div class="voice-design-box">
            <h4>ğŸ™ï¸ Voice Design</h4>
            <p class="small-hint">Lade eine 10s Aufnahme hoch, damit Crafty so spricht!</p>

            <div class="voice-upload-area" id="voice-upload-dropzone">
              <span id="voice-file-label">Datei auswÃ¤hlen (.wav)</span>
              <input type="file" id="voice-upload-input" accept=".wav" style="display: none;">
              <button class="mc-button small" id="btn-upload-voice">Hochladen</button>
            </div>

            <label class="settings-row">
              <span>Aktives Profil:</span>
              <select id="voice-profile-select">
                <option value="default">Standard Crafty</option>
              </select>
            </label>
          </div>
        </div>

        <label class="settings-row">
          <span>Geschwindigkeit:</span>
          <input type="range" id="tts-speed" min="0.5" max="2" step="0.1" value="0.9">
          <span id="tts-speed-value">0.9x</span>
        </label>
        <button class="mc-button" id="btn-test-tts">ğŸ”Š Testen</button>
      </div>

      <div class="settings-section">
        <h3>ğŸ§  LLM</h3>
        <label class="settings-row">
          <span>Provider:</span>
          <select id="llm-provider">
            <option value="ollama">ğŸ¦™ Ollama (lokal)</option>
            <option value="openai">ğŸ¤– OpenAI</option>
            <option value="anthropic">ğŸ§  Anthropic Claude</option>
          </select>
        </label>
        <label class="settings-row">
          <span>Server:</span>
          <input type="text" id="llm-url" placeholder="http://127.0.0.1:11434/v1">
        </label>
        <label class="settings-row">
          <span>Modell:</span>
          <select id="llm-model">
            <option value="llama3.2:latest">llama3.2:latest</option>
          </select>
          <button class="mc-button small" id="btn-refresh-models" title="Modelle aktualisieren">ğŸ”„</button>
        </label>
        <label class="settings-row api-key-row" id="llm-api-key-row" style="display: none;">
          <span>API-Key:</span>
          <input type="password" id="llm-api-key" placeholder="API-Key">
          <button class="mc-button small" id="btn-validate-llm-key" title="API-Key prÃ¼fen">âœ“</button>
        </label>
        <p class="settings-hint" id="llm-hint">ğŸ’¡ Ollama braucht keinen API-Key</p>
        <button class="mc-button" id="btn-test-llm">ğŸ§ª Verbindung testen</button>
      </div>

      <div class="modal-buttons">
        <button class="mc-button primary" id="btn-save-settings">ğŸ’¾ Speichern</button>
        <button class="mc-button" id="btn-close-settings">âŒ SchlieÃŸen</button>
      </div>
    </div>
  </div>

  <script src="craftyBrain.js"></script>
  <script src="voiceController.js"></script>
  <script src="components/chatPanel.js"></script>
  <script src="voiceFeatures.js"></script>
  <script src="app.js"></script>
</body>

</html>