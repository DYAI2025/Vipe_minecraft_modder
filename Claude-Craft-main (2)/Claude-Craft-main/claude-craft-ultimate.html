<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Claude-Craft Ultimate - AI-Powered Minecraft Modding</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            grid-template-rows: 70px 1fr auto;
            height: 100vh;
            gap: 2px;
            background: rgba(0,0,0,0.3);
        }
        
        /* Header */
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899);
            display: flex;
            align-items: center;
            padding: 0 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            flex: 1;
            font-size: 24px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .ai-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(0,0,0,0.2);
            border-radius: 20px;
            font-size: 14px;
        }
        
        .ai-status.connected {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
        }
        
        .ai-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Sidebar */
        .sidebar {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            overflow-y: auto;
        }
        
        .quick-actions {
            margin-bottom: 25px;
        }
        
        .quick-actions h3 {
            color: #60a5fa;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }
        
        .action-btn {
            width: 100%;
            padding: 14px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .action-btn .icon {
            font-size: 20px;
        }
        
        /* 3D Viewer */
        .viewer-container {
            background: rgba(0, 0, 0, 0.5);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        #canvas-3d {
            flex: 1;
            position: relative;
            background: radial-gradient(ellipse at center, #1e3a8a 0%, #0f172a 100%);
        }
        
        .viewer-overlay {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 10;
        }
        
        .viewer-info {
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-radius: 12px;
            pointer-events: auto;
        }
        
        .viewer-controls {
            display: flex;
            gap: 8px;
            pointer-events: auto;
        }
        
        .viewer-controls button {
            width: 40px;
            height: 40px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
        }
        
        .viewer-controls button:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }
        
        /* AI Chat Panel */
        .ai-panel {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 15px 20px;
            background: rgba(99, 102, 241, 0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 85%;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }
        
        .message.ai {
            align-self: flex-start;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .message.system {
            align-self: center;
            background: rgba(251, 146, 60, 0.2);
            border: 1px solid rgba(251, 146, 60, 0.3);
            font-size: 12px;
            text-align: center;
        }
        
        .chat-input-container {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .chat-input-wrapper {
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .chat-input:focus {
            outline: none;
            background: rgba(255,255,255,0.15);
            border-color: #6366f1;
        }
        
        .chat-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .send-btn, .voice-btn {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        
        .voice-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #ef4444;
        }
        
        .voice-btn.active {
            background: rgba(239, 68, 68, 0.8);
            color: white;
            animation: voicePulse 1s infinite;
        }
        
        @keyframes voicePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }
        
        /* Properties Panel */
        .properties-container {
            grid-column: 1 / -1;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .property-group {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
        }
        
        .property-group h4 {
            color: #60a5fa;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 12px;
        }
        
        .property-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .property-label {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
        }
        
        .property-value {
            font-size: 13px;
            color: #10b981;
            font-weight: 600;
        }
        
        /* Loading Animation */
        .loading-dots {
            display: inline-flex;
            gap: 4px;
        }
        
        .loading-dots span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: loadingDot 1.4s infinite both;
        }
        
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes loadingDot {
            0%, 80%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            40% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 90px;
            right: 20px;
            padding: 16px 20px;
            background: rgba(16, 185, 129, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideInNotif 0.5s ease;
            z-index: 1000;
        }
        
        @keyframes slideInNotif {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>üéÆ Claude-Craft Ultimate</h1>
            <div class="ai-status connected">
                <div class="ai-indicator"></div>
                <span>Moonshot AI Connected</span>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="quick-actions">
                <h3>‚ö° Schnellaktionen</h3>
                <button class="action-btn" onclick="aiCommand('Erstelle einen leuchtenden Diamantblock')">
                    <span class="icon">üíé</span>
                    <span>Diamant-Erz</span>
                </button>
                <button class="action-btn" onclick="aiCommand('Mache ein magisches Schwert mit Feuereffekt')">
                    <span class="icon">‚öîÔ∏è</span>
                    <span>Magisches Schwert</span>
                </button>
                <button class="action-btn" onclick="aiCommand('Erstelle TNT das bei Kontakt explodiert')">
                    <span class="icon">üß®</span>
                    <span>Super TNT</span>
                </button>
                <button class="action-btn" onclick="aiCommand('Baue einen Block der Musik spielt')">
                    <span class="icon">üéµ</span>
                    <span>Musikblock</span>
                </button>
            </div>
            
            <div class="quick-actions">
                <h3>üìÅ Projekt</h3>
                <button class="action-btn" onclick="exportAll()">
                    <span class="icon">üíæ</span>
                    <span>Export zu MCreator</span>
                </button>
                <button class="action-btn" onclick="generateCode()">
                    <span class="icon">‚òï</span>
                    <span>Java Code</span>
                </button>
                <button class="action-btn" onclick="saveProject()">
                    <span class="icon">üìÇ</span>
                    <span>Projekt speichern</span>
                </button>
            </div>
        </div>
        
        <!-- 3D Viewer -->
        <div class="viewer-container">
            <div id="canvas-3d">
                <div class="viewer-overlay">
                    <div class="viewer-info">
                        <div id="objectName" style="font-weight: 600;">Bereit f√ºr deine Ideen!</div>
                        <div id="objectType" style="font-size: 12px; opacity: 0.7;">Kein Objekt</div>
                    </div>
                    <div class="viewer-controls">
                        <button onclick="resetView()" title="Reset">üîÑ</button>
                        <button onclick="toggleWireframe()" title="Wireframe">üìê</button>
                        <button onclick="screenshot()" title="Screenshot">üì∏</button>
                        <button onclick="toggleRotation()" title="Auto-Rotation">üîÑ</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Chat Panel -->
        <div class="ai-panel">
            <div class="chat-header">
                <h3 style="font-size: 16px; font-weight: 600;">ü§ñ AI Modding-Assistent</h3>
                <p style="font-size: 12px; opacity: 0.7; margin-top: 5px;">Beschreibe deine Minecraft-Idee!</p>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    Hallo! Ich bin dein AI-Modding-Assistent! üéÆ<br><br>
                    Beschreibe mir, was du erstellen m√∂chtest. Zum Beispiel:<br>
                    ‚Ä¢ "Ein Block der bei Nacht leuchtet"<br>
                    ‚Ä¢ "Ein Schwert das Blitze schie√üt"<br>
                    ‚Ä¢ "TNT das gr√∂√üere Explosionen macht"
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text" class="chat-input" id="chatInput" 
                           placeholder="Beschreibe deine Mod-Idee..." 
                           onkeypress="if(event.key === 'Enter') sendMessage()">
                    <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">
                        üé§
                    </button>
                    <button class="send-btn" onclick="sendMessage()">
                        ‚û§
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Properties Panel -->
        <div class="properties-container">
            <div class="properties-grid">
                <div class="property-group">
                    <h4>üìù Basis</h4>
                    <div class="property-item">
                        <span class="property-label">Name:</span>
                        <span class="property-value" id="propName">-</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">Typ:</span>
                        <span class="property-value" id="propType">-</span>
                    </div>
                </div>
                
                <div class="property-group">
                    <h4>‚öôÔ∏è Physik</h4>
                    <div class="property-item">
                        <span class="property-label">H√§rte:</span>
                        <span class="property-value" id="propHardness">-</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">Tool:</span>
                        <span class="property-value" id="propTool">-</span>
                    </div>
                </div>
                
                <div class="property-group">
                    <h4>‚ú® Effekte</h4>
                    <div class="property-item">
                        <span class="property-label">Licht:</span>
                        <span class="property-value" id="propLight">0</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">Partikel:</span>
                        <span class="property-value" id="propParticles">Keine</span>
                    </div>
                </div>
                
                <div class="property-group">
                    <h4>üíé Drops</h4>
                    <div class="property-item">
                        <span class="property-label">Item:</span>
                        <span class="property-value" id="propDrop">-</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">XP:</span>
                        <span class="property-value" id="propXP">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // ============================================
        // MOONSHOT AI INTEGRATION
        // ============================================
        
        const MOONSHOT_API_KEY = 'sk-6hUzRJcA6jU7PB5UYGVIqsndQovhjtZgYHi0C2CKPxgnFHvz';
        const MOONSHOT_API_URL = 'https://api.moonshot.cn/v1/chat/completions';
        
        // Konversations-Historie f√ºr Kontext
        let conversationHistory = [];
        
        async function callMoonshotAI(userMessage) {
            try {
                addMessage(userMessage, 'user');
                
                // Zeige Lade-Animation
                const loadingId = addMessage('<div class="loading-dots"><span></span><span></span><span></span></div>', 'ai');
                
                const response = await fetch(MOONSHOT_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MOONSHOT_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'moonshot-v1-8k',
                        messages: [
                            {
                                role: 'system',
                                content: `Du bist ein Minecraft Modding-Assistent. Du hilfst beim Erstellen von Minecraft Mods.
                                
                                Wenn der Nutzer eine Mod-Idee beschreibt, antworte mit einem JSON-Objekt mit diesen Eigenschaften:
                                {
                                    "type": "block|item|entity|tool|food|armor",
                                    "name": "technischer_name",
                                    "displayName": "Anzeigename",
                                    "description": "Beschreibung",
                                    "color": "#hexcolor",
                                    "hardness": zahl,
                                    "resistance": zahl,
                                    "lightLevel": 0-15,
                                    "tool": "pickaxe|axe|shovel|none",
                                    "toolLevel": 0-4,
                                    "drops": {"item": "name", "count": zahl},
                                    "xp": zahl,
                                    "transparent": true/false,
                                    "effects": ["glow", "particles", "float"],
                                    "damage": zahl (f√ºr Waffen),
                                    "durability": zahl (f√ºr Tools),
                                    "special": "beschreibung besonderer Eigenschaften"
                                }
                                
                                Antworte IMMER mit einem validen JSON und einer kurzen Erkl√§rung danach.`
                            },
                            ...conversationHistory,
                            { role: 'user', content: userMessage }
                        ],
                        temperature: 0.7,
                        max_tokens: 800
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                // Entferne Lade-Animation
                removeMessage(loadingId);
                
                // Parse AI Response
                try {
                    // Extrahiere JSON aus der Antwort
                    const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const modProperties = JSON.parse(jsonMatch[0]);
                        
                        // Erstelle das Objekt im 3D-Viewer
                        createFromAI(modProperties);
                        
                        // Zeige Erkl√§rung
                        const explanation = aiResponse.replace(jsonMatch[0], '').trim();
                        addMessage(`‚úÖ ${modProperties.displayName} erstellt!\n\n${explanation}`, 'ai');
                        
                        // Update Properties Display
                        updatePropertiesDisplay(modProperties);
                        
                        // Speichere in Historie
                        conversationHistory.push(
                            { role: 'user', content: userMessage },
                            { role: 'assistant', content: aiResponse }
                        );
                        
                        // Halte Historie kurz (max 10 Nachrichten)
                        if (conversationHistory.length > 10) {
                            conversationHistory = conversationHistory.slice(-10);
                        }
                    } else {
                        // Keine JSON-Antwort, zeige normale Nachricht
                        addMessage(aiResponse, 'ai');
                    }
                } catch (parseError) {
                    console.error('Parse Error:', parseError);
                    addMessage(aiResponse, 'ai');
                }
                
            } catch (error) {
                console.error('Moonshot AI Error:', error);
                removeMessage(loadingId);
                addMessage('‚ùå Fehler bei der AI-Verbindung. Verwende Fallback...', 'system');
                
                // Fallback zu lokaler Verarbeitung
                processLocally(userMessage);
            }
        }
        
        function processLocally(message) {
            const lower = message.toLowerCase();
            
            // Einfache Keyword-Erkennung
            let properties = {
                type: 'block',
                name: 'custom_block',
                displayName: 'Custom Block',
                color: '#4a5568',
                hardness: 1.5,
                lightLevel: 0
            };
            
            if (lower.includes('diamant')) {
                properties = {
                    ...properties,
                    name: 'diamond_ore_plus',
                    displayName: 'Verbessertes Diamanterz',
                    color: '#00ffff',
                    hardness: 3,
                    lightLevel: 7,
                    drops: { item: 'diamond', count: 3 },
                    xp: 10
                };
            } else if (lower.includes('schwert')) {
                properties = {
                    type: 'tool',
                    name: 'fire_sword',
                    displayName: 'Feuerschwert',
                    color: '#ff4500',
                    damage: 10,
                    durability: 2000,
                    effects: ['fire', 'glow']
                };
            } else if (lower.includes('tnt') || lower.includes('explo')) {
                properties = {
                    ...properties,
                    name: 'super_tnt',
                    displayName: 'Super TNT',
                    color: '#ff0000',
                    special: 'Gr√∂√üere Explosion'
                };
            }
            
            createFromAI(properties);
            addMessage(`‚úÖ ${properties.displayName} wurde erstellt!`, 'ai');
            updatePropertiesDisplay(properties);
        }
        
        // ============================================
        // 3D VIEWER ENGINE
        // ============================================
        
        let scene, camera, renderer, currentObject;
        let animations = [];
        let autoRotate = false;
        
        function init3D() {
            const container = document.getElementById('canvas-3d');
            const rect = container.getBoundingClientRect();
            
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f172a);
            scene.fog = new THREE.Fog(0x0f172a, 10, 50);
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, rect.width / rect.height, 0.1, 1000);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(rect.width, rect.height);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
            directionalLight.position.set(10, 20, 10);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0x6366f1, 0.5, 20);
            pointLight.position.set(-5, 10, 0);
            scene.add(pointLight);
            
            // Grid
            const gridHelper = new THREE.GridHelper(20, 20, 0x2a2a4a, 0x1a1a3a);
            scene.add(gridHelper);
            
            // Mouse Controls
            setupMouseControls();
            
            // Animation Loop
            animate();
            
            console.log('‚úÖ 3D Engine initialisiert');
        }
        
        function setupMouseControls() {
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            
            renderer.domElement.addEventListener('mousedown', () => {
                isDragging = true;
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaMove = {
                        x: e.offsetX - previousMousePosition.x,
                        y: e.offsetY - previousMousePosition.y
                    };
                    
                    const rotationSpeed = 0.005;
                    const spherical = new THREE.Spherical();
                    spherical.setFromVector3(camera.position);
                    spherical.theta -= deltaMove.x * rotationSpeed;
                    spherical.phi += deltaMove.y * rotationSpeed;
                    spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                    camera.position.setFromSpherical(spherical);
                    camera.lookAt(0, 0, 0);
                }
                
                previousMousePosition = { x: e.offsetX, y: e.offsetY };
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                const scale = e.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(scale);
            });
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Auto-Rotation
            if (autoRotate && currentObject) {
                currentObject.rotation.y += 0.01;
            }
            
            // Animations
            animations.forEach(anim => anim());
            
            renderer.render(scene, camera);
        }
        
        // ============================================
        // OBJEKT-ERSTELLUNG VON AI
        // ============================================
        
        function createFromAI(properties) {
            console.log('Erstelle von AI:', properties);
            
            // Clear old object
            if (currentObject) {
                scene.remove(currentObject);
                animations = [];
            }
            
            // Erstelle basierend auf Typ
            if (properties.type === 'tool' || properties.type === 'item') {
                createTool(properties);
            } else {
                createBlock(properties);
            }
            
            // Update UI
            document.getElementById('objectName').textContent = properties.displayName || 'Custom Object';
            document.getElementById('objectType').textContent = properties.type || 'block';
            
            // Effekte anwenden
            if (properties.effects) {
                properties.effects.forEach(effect => {
                    applyEffect(effect);
                });
            }
            
            showNotification(`‚úÖ ${properties.displayName} wurde erstellt!`);
        }
        
        function createBlock(properties) {
            const geometry = new THREE.BoxGeometry(2, 2, 2);
            const material = new THREE.MeshPhongMaterial({
                color: properties.color || 0x4a5568,
                transparent: properties.transparent || false,
                opacity: properties.transparent ? 0.7 : 1.0,
                emissive: properties.lightLevel ? new THREE.Color(properties.color || 0xffffff) : 0x000000,
                emissiveIntensity: (properties.lightLevel || 0) / 30
            });
            
            currentObject = new THREE.Mesh(geometry, material);
            currentObject.position.y = 1;
            currentObject.castShadow = true;
            currentObject.receiveShadow = true;
            scene.add(currentObject);
            
            // Partikel f√ºr Erz-Bl√∂cke
            if (properties.type === 'ore' || properties.effects?.includes('particles')) {
                addParticles(properties.color);
            }
        }
        
        function createTool(properties) {
            const group = new THREE.Group();
            
            // Handle
            const handleGeometry = new THREE.CylinderGeometry(0.1, 0.1, 2, 8);
            const handleMaterial = new THREE.MeshPhongMaterial({ color: 0x8b4513 });
            const handle = new THREE.Mesh(handleGeometry, handleMaterial);
            group.add(handle);
            
            // Blade
            const bladeGeometry = new THREE.BoxGeometry(0.05, 3, 0.5);
            const bladeMaterial = new THREE.MeshPhongMaterial({
                color: properties.color || 0xc0c0c0,
                emissive: properties.color || 0xc0c0c0,
                emissiveIntensity: 0.3
            });
            const blade = new THREE.Mesh(bladeGeometry, bladeMaterial);
            blade.position.y = 2.5;
            group.add(blade);
            
            currentObject = group;
            currentObject.position.y = 2;
            scene.add(currentObject);
            
            // Auto-rotate tools
            autoRotate = true;
        }
        
        function addParticles(color = 0x00ffff) {
            const particleCount = 100;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 4;
                positions[i + 1] = Math.random() * 4;
                positions[i + 2] = (Math.random() - 0.5) * 4;
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const material = new THREE.PointsMaterial({
                color: color,
                size: 0.1,
                transparent: true,
                opacity: 0.6
            });
            
            const particles = new THREE.Points(geometry, material);
            currentObject.add(particles);
            
            // Animate particles
            animations.push(() => {
                particles.rotation.y += 0.01;
            });
        }
        
        function applyEffect(effect) {
            switch(effect) {
                case 'glow':
                    if (currentObject.material) {
                        currentObject.material.emissiveIntensity = 0.5;
                    }
                    break;
                case 'float':
                    let floatTime = 0;
                    animations.push(() => {
                        floatTime += 0.03;
                        currentObject.position.y = 2 + Math.sin(floatTime) * 0.5;
                    });
                    break;
                case 'pulse':
                    let pulseTime = 0;
                    animations.push(() => {
                        pulseTime += 0.05;
                        const scale = 1 + Math.sin(pulseTime) * 0.2;
                        currentObject.scale.set(scale, scale, scale);
                    });
                    break;
            }
        }
        
        // ============================================
        // CHAT INTERFACE
        // ============================================
        
        let messageId = 0;
        
        function addMessage(text, type = 'user') {
            const messagesContainer = document.getElementById('chatMessages');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.innerHTML = text;
            message.id = `msg-${++messageId}`;
            messagesContainer.appendChild(message);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            return message.id;
        }
        
        function removeMessage(id) {
            const message = document.getElementById(id);
            if (message) message.remove();
        }
        
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                callMoonshotAI(message);
                input.value = '';
            }
        }
        
        function aiCommand(command) {
            document.getElementById('chatInput').value = command;
            sendMessage();
        }
        
        // ============================================
        // VOICE RECOGNITION
        // ============================================
        
        let recognition = null;
        let isListening = false;
        
        function toggleVoice() {
            const btn = document.getElementById('voiceBtn');
            
            if (!recognition) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    addMessage('‚ùå Spracherkennung wird nur in Chrome/Edge unterst√ºtzt!', 'system');
                    return;
                }
                
                recognition = new SpeechRecognition();
                recognition.lang = 'de-DE';
                recognition.continuous = false;
                recognition.interimResults = true;
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('chatInput').value = transcript;
                    
                    if (event.results[0].isFinal) {
                        sendMessage();
                    }
                };
                
                recognition.onerror = (event) => {
                    console.error('Speech error:', event.error);
                    btn.classList.remove('active');
                    isListening = false;
                };
                
                recognition.onend = () => {
                    btn.classList.remove('active');
                    isListening = false;
                };
            }
            
            if (isListening) {
                recognition.stop();
                btn.classList.remove('active');
                isListening = false;
            } else {
                recognition.start();
                btn.classList.add('active');
                isListening = true;
            }
        }
        
        // ============================================
        // PROPERTIES DISPLAY
        // ============================================
        
        function updatePropertiesDisplay(props) {
            document.getElementById('propName').textContent = props.name || '-';
            document.getElementById('propType').textContent = props.type || 'block';
            document.getElementById('propHardness').textContent = props.hardness || '1.5';
            document.getElementById('propTool').textContent = props.tool || 'any';
            document.getElementById('propLight').textContent = props.lightLevel || '0';
            document.getElementById('propParticles').textContent = props.effects?.includes('particles') ? 'Ja' : 'Nein';
            document.getElementById('propDrop').textContent = props.drops?.item || props.name || '-';
            document.getElementById('propXP').textContent = props.xp || '0';
        }
        
        // ============================================
        // VIEWER CONTROLS
        // ============================================
        
        function resetView() {
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
        }
        
        function toggleWireframe() {
            if (currentObject && currentObject.material) {
                currentObject.material.wireframe = !currentObject.material.wireframe;
            }
        }
        
        function screenshot() {
            renderer.render(scene, camera);
            renderer.domElement.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = 'minecraft-mod-preview.png';
                link.href = url;
                link.click();
            });
        }
        
        function toggleRotation() {
            autoRotate = !autoRotate;
        }
        
        // ============================================
        // EXPORT FUNCTIONS
        // ============================================
        
        function exportAll() {
            showNotification('üì¶ Exportiere zu MCreator...');
            // Hier w√ºrde der echte Export stattfinden
        }
        
        function generateCode() {
            showNotification('‚òï Generiere Java Code...');
            // Hier w√ºrde die Code-Generierung stattfinden
        }
        
        function saveProject() {
            const projectData = {
                timestamp: new Date().toISOString(),
                conversation: conversationHistory,
                // Weitere Projektdaten
            };
            
            localStorage.setItem('claudeCraftProject', JSON.stringify(projectData));
            showNotification('üíæ Projekt gespeichert!');
        }
        
        // ============================================
        // NOTIFICATIONS
        // ============================================
        
        function showNotification(text) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = text;
            document.body.appendChild(notif);
            
            setTimeout(() => {
                notif.style.animation = 'slideInNotif 0.5s ease reverse';
                setTimeout(() => notif.remove(), 500);
            }, 3000);
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Claude-Craft Ultimate startet...');
            init3D();
            
            // Enter-Taste f√ºr Chat
            document.getElementById('chatInput').focus();
            
            // Willkommensnachricht
            setTimeout(() => {
                addMessage('üí° Tipp: Beschreibe deine Idee so detailliert wie m√∂glich f√ºr beste Ergebnisse!', 'system');
            }, 2000);
        });
        
        // Window Resize
        window.addEventListener('resize', () => {
            const container = document.getElementById('canvas-3d');
            const rect = container.getBoundingClientRect();
            camera.aspect = rect.width / rect.height;
            camera.updateProjectionMatrix();
            renderer.setSize(rect.width, rect.height);
        });
    </script>
</body>
</html>