# Assembly Plan Checklist (v1) - Mod Studio for Kids  Status: Draft v1 Owner: Core Team Last updated: 2026-01-02  This checklist is the "wiring plan" to assemble the system cleanly. It references the contracts: - project-json-spec-v1.md - ipc-bridge-spec-v1.md - exporter-manifest-v1.md  Conventions: - [ ] = todo - [x] = done - (P0/P1/P2) = priority - "DoD" = definition of done - All text ASCII-only.  ------------------------------------------------------------ PHASE 0 - Repo Hygiene / Dev Loop (foundation) ------------------------------------------------------------  Goal: - Make the repo build/test predictable locally and in CI.  Tasks: - [ ] (P0) Pin Node + pnpm versions (tooling consistency)   - Files: README.md (or new docs/dev.md), package.json (engines)   - DoD:     - Devs can run `pnpm i` without version drift issues.  - [ ] (P0) Confirm workspace scripts run end-to-end   - Commands:     - `pnpm -r build`     - `pnpm -r test`     - `pnpm -r lint` (if configured)   - DoD:     - All commands complete without manual steps (or docs explain exceptions).  - [ ] (P1) Add a "smoke" script for quick validation   - Files: root package.json   - Suggested scripts:     - `smoke:core` -> run core-model tests only     - `smoke:app` -> build renderer + electron compile (no packaging)   - DoD:     - Single command for a quick "is it alive" check.  Verification: - [ ] CI green on a clean checkout.  ------------------------------------------------------------ PHASE 1 - Core Domain Truth (core-model first) ------------------------------------------------------------  Goal: - Project JSON spec is real, validated, and reducer is correct. - No placeholders (`...`) remain in the domain package. - Tests fully cover the MVP domain behavior.  Decision gates: - [ ] (P0) Decide ID policy (must choose one):   - Option A (recommended): IDs immutable after creation   - Option B: explicit rename actions + ref updates  Tasks (core-model): - [ ] (P0) Implement final Zod schema (no placeholders)   - File: packages/core-model/src/schema.ts   - Must include:     - ProjectFile schemaVersion=1     - meta (modId/name/version required)     - blocks/items/recipes containers     - TextureSpec (preset/dataUri)     - RecipeSpec (shaped)   - DoD:     - schema matches project-json-spec-v1.md exactly.  - [ ] (P0) Implement semantic validation   - File: packages/core-model/src/validate.ts   - Must validate:     - schemaVersion known     - regex checks     - key == value.id invariant     - texture rules (preset allowlist OR dataUri png)     - recipe key coverage + refs exist or minecraft:*     - result exists or minecraft:*   - DoD:     - validateProject returns structured errors (code + path + message).  - [ ] (P0) Finalize actions union (no placeholders)   - File: packages/core-model/src/actions.ts   - Must include:     - UPDATE_META     - CREATE/UPDATE/DELETE for blocks/items/recipes     - LOAD_PROJECT     - UNDO/REDO     - If Option B: RENAME_* actions   - DoD:     - Types compile without `any` escapes.  - [ ] (P0) Fix reducer and history wrapper (no placeholders)   - File: packages/core-model/src/reducer.ts   - Requirements:     - Pure functions, deterministic updates     - Undo/Redo updates only project domain (not UI state)     - History limit (e.g. 50) deterministic     - If IDs immutable: prevent id edits at reducer level (reject or ignore)     - If rename actions: implement move + ref updates   - DoD:     - Reducer tests cover create/update/delete + undo/redo + load.  - [ ] (P1) Stabilize CommandParser (optional but recommended)   - File: packages/core-model/src/parser.ts   - Requirements:     - Parse returns { action?, confidence, error? }     - No fragile regex crashes   - DoD:     - Parser tests reflect intended language patterns.  - [ ] (P1) Explain layer accurate and helpful   - File: packages/core-model/src/explain.ts   - Requirements:     - explainLastAction(state) never throws   - DoD:     - explain tests pass.  Tests (core-model): - [ ] (P0) Update/add tests to match spec   - Files:     - packages/core-model/src/__tests__/schema.test.ts     - packages/core-model/src/__tests__/validate.test.ts (add if missing)     - packages/core-model/src/__tests__/reducer.test.ts     - packages/core-model/src/__tests__/parser.test.ts     - packages/core-model/src/__tests__/explain.test.ts   - DoD:     - `pnpm -C packages/core-model test` green.  Integration point (renderer implications): - [ ] (P0) If ID immutable: make EditorPanel show id as read-only   - File: apps/studio-electron/src/renderer/ui/EditorPanel.tsx   - DoD:     - UI no longer edits IDs directly (prevents broken refs).  Verification: - [ ] ProjectFile example from contract validates - [ ] Invalid recipe refs are rejected with readable errors  ------------------------------------------------------------ PHASE 2 - Persistence and IPC Contract (save/load + sandbox) ------------------------------------------------------------  Goal: - Save/Load works end-to-end through IPC. - workspace sandbox is enforced. - Bridge uses a stable typed contract.  Tasks (main process): - [ ] (P0) Implement project:save with atomic write   - File: apps/studio-electron/src/main/ipc.ts   - Requirements:     - req: { workspaceDir, project }     - use workspace.ts safeJoin(workspaceDir, "project.json")     - validateProject(project) in main (import core-model)     - write tmp -> rename for atomicity     - return IpcResult   - DoD:     - Save creates/updates project.json reliably.  - [ ] (P0) Implement project:load with validation and clear errors   - File: apps/studio-electron/src/main/ipc.ts   - Requirements:     - read project.json from safeJoin     - parse JSON     - validateProject (or migrate then validate)     - return project or E_VALIDATION / E_NOT_FOUND   - DoD:     - Load returns exact ProjectFile.  - [ ] (P0) Enforce workspace sandbox everywhere FS is used   - Files:     - apps/studio-electron/src/main/ipc.ts     - apps/studio-electron/src/main/workspace.ts   - DoD:     - Path traversal attempts rejected (E_PATH_TRAVERSAL).  Tasks (preload bridge): - [ ] (P1) Enforce IPC whitelist in preload   - File: apps/studio-electron/src/preload/bridge.ts   - Requirements:     - Only allow known channels   - DoD:     - Unknown channel cannot be invoked.  Tasks (renderer): - [ ] (P0) Wire persistence.ts to the new IPC envelope   - File: apps/studio-electron/src/renderer/state/persistence.ts   - Requirements:     - handle IpcResult ok/fail     - on fail: return error to UI (toast)   - DoD:     - Save/Load errors show helpful messages.  - [ ] (P1) Improve ProjectContext load/save UX   - File: apps/studio-electron/src/renderer/state/ProjectContext.tsx   - Requirements:     - if workspaceDir missing -> toast + prompt selectWorkspace     - success toast   - DoD:     - Users cannot silently fail to save.  Types: - [ ] (P0) Update bridge.d.ts to match ipc-bridge-spec-v1.md   - File: apps/studio-electron/src/renderer/types/bridge.d.ts   - DoD:     - No `any` needed for IPC return types.  Verification: - [ ] Manual:   - select workspace -> save -> restart app -> load -> identical project - [ ] Unit/integration (recommended):   - Add minimal IPC handler tests (optional, P2)  ------------------------------------------------------------ PHASE 3 - Exporter Deterministic Output (manifest v1) ------------------------------------------------------------  Goal: - Exporter produces a valid Fabric Loom project with deterministic structure. - Textures, models, blockstates, lang, Java registry are generated. - `gradlew build` succeeds (locally at least).  Tasks (exporter core): - [ ] (P0) Remove placeholders from exporter entrypoint   - File: packages/exporter/src/index.ts   - Requirements:     - copy template -> outputDir     - replace placeholders (modId/name/version/desc)     - rename mixin.json -> <modId>.mixins.json (if applicable)     - generate resources per manifest   - DoD:     - exportProject writes full expected tree.  - [ ] (P0) Implement textures writing (dataUri preferred)   - Files:     - packages/exporter/src/generators/assets.ts     - packages/exporter/src/index.ts   - Requirements:     - For each block/item, compute PNG bytes     - Write to textures/block and textures/item paths   - DoD:     - Every exported entity has a PNG texture file.  - [ ] (P0) Implement JSON generators fully   - File: packages/exporter/src/generators/json.ts   - Requirements:     - lang/en_us.json     - blockstates/*.json     - models/block/*.json     - models/item/*.json for items and block items   - DoD:     - JSON matches exporter-manifest-v1.md.  - [ ] (P0) Implement Java generator fully   - File: packages/exporter/src/generators/java.ts   - Requirements:     - deterministic package path     - registry of blocks/items + block items     - property mapping (hardness, luminance, transparent)   - DoD:     - Java compiles in Gradle build.  - [ ] (P1) Make build runner robust   - File: packages/exporter/src/builder.ts   - Requirements:     - detect gradlew (win/unix)     - chmod + spawn     - capture logs     - locate jar under build/libs   - DoD:     - runBuild returns jarPath and logs, or a clean error.  Template: - [ ] (P1) Ensure template includes wrapper artifacts needed for build   - Path: packages/exporter/template/*   - DoD:     - Export output is buildable without external gradle install (wrapper present).  Tests: - [ ] (P0) Update exporter tests to assert manifest tree   - Files:     - packages/exporter/src/__tests__/exporter.test.ts     - packages/exporter/src/__tests__/full_export.test.ts   - DoD:     - Tests verify key files exist and contain correct placeholders.  Verification: - [ ] Manual local:   - Export minimal project (1 block, 1 item)   - `cd outputDir && ./gradlew build`   - Confirm jar exists under build/libs   - Confirm jar contains assets/<modId>/*  ------------------------------------------------------------ PHASE 4 - Build/Test Pipeline Reliability (Main orchestration) ------------------------------------------------------------  Goal: - One-click pipeline export->build->test produces clear progress and actionable errors. - Testbot analyzer gives reason codes (build failed vs test failed).  Tasks (main build service): - [ ] (P0) Ensure pipeline:start validates project before running   - File: apps/studio-electron/src/main/buildService.ts   - DoD:     - invalid project yields immediate E_VALIDATION.  - [ ] (P1) Progress events are consistent and UI-friendly   - File: apps/studio-electron/src/main/buildService.ts   - Requirements:     - send step transitions     - include short message + optional details   - DoD:     - UI Stepper never gets stuck.  - [ ] (P1) Implement cancel support (optional but recommended)   - Files:     - apps/studio-electron/src/main/buildService.ts     - apps/studio-electron/src/main/ipc.ts (pipeline:cancel)   - DoD:     - cancel stops child processes and sends status error/cancel.  Tasks (testbot): - [ ] (P0) Remove placeholders from runner/analyzer   - Files:     - packages/testbot/src/runner.ts     - packages/testbot/src/analyzer.ts   - Requirements:     - stable timeout behavior     - analyzer identifies success and common crash patterns   - DoD:     - `pnpm -C packages/testbot test` green.  Renderer UI: - [ ] (P0) BuildDialog handles ok/fail envelope and shows details   - File: apps/studio-electron/src/renderer/ui/BuildDialog.tsx   - DoD:     - On error, show user message + optional details (toggle).  Verification: - [ ] Pipeline run on minimal project:   - export ok   - build ok   - test ok OR test skipped with explicit messaging  ------------------------------------------------------------ PHASE 5 - UX and Safety Hardening ------------------------------------------------------------  Goal: - Kid-friendly experience: clear errors, no footguns, stable onboarding. - Security posture: strict IPC, no accidental FS escapes.  Tasks (UX): - [ ] (P1) Toast coverage for all user-facing actions   - Files:     - apps/studio-electron/src/renderer/state/ToastContext.tsx     - ProjectContext.tsx, BuildDialog.tsx, EditorPanel.tsx   - DoD:     - Save/Load/Export/Test always gives feedback.  - [ ] (P1) Onboarding wizard writes real settings (or remove simulation)   - File: apps/studio-electron/src/renderer/ui/OnboardingWizard.tsx   - DoD:     - Clear local vs cloud mode behavior, no dead buttons.  - [ ] (P2) Help search improvements (ranking/snippets)   - File: apps/studio-electron/src/main/helpService.ts   - DoD:     - Top results are relevant; excerpt highlights query.  Tasks (Safety): - [ ] (P0) Enforce IPC whitelist in preload (again - must)   - File: apps/studio-electron/src/preload/bridge.ts   - DoD:     - Only defined channels can be used.  - [ ] (P1) Validate all incoming strings in main (length clamps)   - File: apps/studio-electron/src/main/ipc.ts   - DoD:     - No huge payloads that can freeze the app.  - [ ] (P2) Consider enabling sandbox / tightening BrowserWindow prefs   - File: apps/studio-electron/src/main/index.ts   - DoD:     - Documented decision; security settings reviewed.  Packaging: - [ ] (P2) Validate electron-builder config produces working distributable   - File: apps/studio-electron/package.json   - DoD:     - Packaged app can load help docs and run pipeline.  ------------------------------------------------------------ MVP "Fast Path" (if you want the shortest route to a working demo) ------------------------------------------------------------  MVP order: 1) Phase 1 (core-model) -> pass tests 2) Phase 2 (save/load IPC) -> demo persistence 3) Phase 3 (exporter) -> export + gradlew build works 4) Phase 4 (pipeline) -> one-click build shows progress  Skip for MVP: - cancel support - fancy onboarding - advanced parser/voice  ------------------------------------------------------------ Definition of Done (overall) ------------------------------------------------------------  - [ ] (P0) Contracts exist in repo:   - docs/contracts/project-json-spec-v1.md   - docs/contracts/ipc-bridge-spec-v1.md   - docs/contracts/exporter-manifest-v1.md   - docs/contracts/assembly-plan.md (this file)  - [ ] (P0) Core-model tests green:   - `pnpm -C packages/core-model test`  - [ ] (P0) Save/Load works end-to-end:   - select workspace -> save -> restart -> load identical  - [ ] (P0) Exporter produces buildable project:   - `./gradlew build` succeeds on exported output  - [ ] (P0) Pipeline shows export/build/test steps with clear errors  ------------------------------------------------------------ Appendix - File map quick links ------------------------------------------------------------  Core: - packages/core-model/src/schema.ts - packages/core-model/src/validate.ts - packages/core-model/src/actions.ts - packages/core-model/src/reducer.ts  IPC: - apps/studio-electron/src/main/ipc.ts - apps/studio-electron/src/main/workspace.ts - apps/studio-electron/src/preload/bridge.ts - apps/studio-electron/src/renderer/state/persistence.ts  Pipeline: - apps/studio-electron/src/main/buildService.ts - packages/exporter/src/index.ts - packages/exporter/src/builder.ts - packages/testbot/src/runner.ts - packages/testbot/src/analyzer.ts - apps/studio-electron/src/renderer/ui/BuildDialog.tsx